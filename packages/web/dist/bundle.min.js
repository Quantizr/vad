!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("onnxruntime-web")):"function"==typeof define&&define.amd?define(["onnxruntime-web"],t):"object"==typeof exports?exports.vad=t(require("onnxruntime-web")):e.vad=t(e.ort)}(self,(e=>{return t={731:e=>{function t(e){return null!=this.min&&(e=Math.max(this.min,e)),null!=this.max&&(e=Math.min(this.max,e)),e}function s(e,t){var s=this._targets;e=this.fence(e),this._lastValue=e;for(var i=0,r=s.length;i<r;i++)s[i].setValueAtTime(e,t)}function i(e,t,s){var i=this._targets;e=this.fence(e);for(var r=0,a=i.length;r<a;r++)i[r].setTargetAtTime&&i[r].setTargetAtTime(e,t,s)}function r(e,t){var s=this._targets;e=this.fence(e),this._lastValue=e;for(var i=0,r=s.length;i<r;i++)s[i].linearRampToValueAtTime(e,t)}function a(e,t){var s=this._targets;e=this.fence(e),this._lastValue=e;for(var i=0,r=s.length;i<r;i++)s[i].exponentialRampToValueAtTime(e,t)}function o(e,t,s){var i=this._targets;this._lastValue=e[e.length-1];for(var r=0,a=i.length;r<a;r++)i[r].setValueCurveAtTime(e,t,s)}function n(e){for(var t=this._targets,s=0,i=t.length;s<i;s++)t[s].cancelScheduledValues(e)}function c(){this._targets=[]}function u(e){this._targets.push(e),null!=this._lastValue&&(e.value=this._lastValue)}e.exports=function(e,h,l){var d=(l=l||{}).targets;!d&&l.target?d=[l.target]:d||(d=[]);var p=Object.create(AudioParam.prototype,{value:{get:function(){return p._lastValue},set:function(e){e=p.fence(e),p._lastValue=e;for(var t=0,s=d.length;t<s;t++)d[t].value=e}},defaultValue:{get:function(){return l.defaultValue}},name:{value:h,writable:!1},min:{value:l.min,writable:!1},max:{value:l.max,writable:!1}});return p._targets=d,p._lastValue=l.defaultValue,p.setValueAtTime=s,p.linearRampToValueAtTime=r,p.exponentialRampToValueAtTime=a,p.setTargetAtTime=i,p.setValueCurveAtTime=o,p.cancelScheduledValues=n,p.addTarget=u,p.clearTargets=c,p.context=e,p.fence=t,null!=l.defaultValue&&(p.value=l.defaultValue),p}},818:(e,t,s)=>{var i=s(731);function r(e,t){this._targetCount+=1,this._output.connect(e,t),"function"==typeof this._onDestinationChange&&this._onDestinationChange(this._targetCount)}function a(e){this._targetCount=0,this._output.disconnect(e),"function"==typeof this._onDestinationChange&&this._onDestinationChange(this._targetCount)}e.exports=function(e,t,s,o){var n=(e||t).context.createGain();return n._onDestinationChange=o,e&&n.connect(e),n._output=t,n._targetCount=0,t&&(n.connect=r,n.disconnect=a),function(e,t){if(t)for(var s=Object.keys(t),r=0,a=s.length;r<a;r++){var o=s[r];e[o]=i(e.context,o,t[o])}}(n,s),n},e.exports.createAudioParam=i},520:(e,t,s)=>{var i=s(818);function r(e){return e<0?e/12:.02278153473118749+.23005591195033048*e+e*e*-.014147877819596033+e*e*e*.0009795096626987743+e*e*e*e*-19413043101157434e-21+e*e*e*e*e*1.8149080040913423e-7}function a(e,t,s,i){for(var r=t*e.sampleRate,a=r+(t-2*s)*e.sampleRate,o=e.createBuffer(1,a,e.sampleRate),n=o.getChannelData(0),c=0;c<r;++c)n[c]=i?(r-c)/a:c/r;for(c=r;c<a;++c)n[c]=0;return o}e.exports=function(e){var t=new u(e),s=e.createGain(),a=e.createGain(),o=e.createGain(),n=e.createGain();o.gain.value=0,s.connect(a),s.connect(o),a.connect(t.input),t.output.connect(n),o.connect(n);var c=i(s,n,{dry:{min:0,defaultValue:0,target:o.gain},wet:{min:0,defaultValue:1,target:a.gain}});t.setPitchOffset(r(12));var h=0;return Object.defineProperty(c,"transpose",{set:function(e){h=r(e),t.setPitchOffset(h)},get:function(){return h}}),c};var o=.1,n=.05,c=.1;function u(e){this.context=e;var t=e.createGain(),s=e.createGain();this.input=t,this.output=s;var i=e.createBufferSource(),r=e.createBufferSource(),u=e.createBufferSource(),h=e.createBufferSource();this.shiftDownBuffer=a(e,c,n,!1),this.shiftUpBuffer=a(e,c,n,!0),i.buffer=this.shiftDownBuffer,r.buffer=this.shiftDownBuffer,u.buffer=this.shiftUpBuffer,h.buffer=this.shiftUpBuffer,i.loop=!0,r.loop=!0,u.loop=!0,h.loop=!0;var l=e.createGain(),d=e.createGain(),p=e.createGain();p.gain.value=0;var f=e.createGain();f.gain.value=0,i.connect(l),r.connect(d),u.connect(p),h.connect(f);var m=e.createGain(),g=e.createGain(),v=e.createDelay(),S=e.createDelay();l.connect(m),d.connect(g),p.connect(m),f.connect(g),m.connect(v.delayTime),g.connect(S.delayTime);var _=e.createBufferSource(),b=e.createBufferSource(),y=function(e,t,s){for(var i=t*e.sampleRate,r=i+(t-2*s)*e.sampleRate,a=e.createBuffer(1,r,e.sampleRate),o=a.getChannelData(0),n=s*e.sampleRate,c=n,u=i-n,h=0;h<i;++h){var l;l=h<c?Math.sqrt(h/n):h>=u?Math.sqrt(1-(h-u)/n):1,o[h]=l}for(h=i;h<r;++h)o[h]=0;return a}(e,c,n);_.buffer=y,b.buffer=y,_.loop=!0,b.loop=!0;var A=e.createGain(),P=e.createGain();A.gain.value=0,P.gain.value=0,_.connect(A.gain),b.connect(P.gain),t.connect(v),t.connect(S),v.connect(A),S.connect(P),A.connect(s),P.connect(s);var w=e.currentTime+.05,T=w+c-n;i.start(w),r.start(T),u.start(w),h.start(T),_.start(w),b.start(T),this.mod1=i,this.mod2=r,this.mod1Gain=l,this.mod2Gain=d,this.mod3Gain=p,this.mod4Gain=f,this.modGain1=m,this.modGain2=g,this.fade1=_,this.fade2=b,this.mix1=A,this.mix2=P,this.delay1=v,this.delay2=S,this.setDelay(o)}u.prototype.setDelay=function(e){this.modGain1.gain.setTargetAtTime(.5*e,0,.01),this.modGain2.gain.setTargetAtTime(.5*e,0,.01)},u.prototype.setPitchOffset=function(e){e>0?(this.mod1Gain.gain.value=0,this.mod2Gain.gain.value=0,this.mod3Gain.gain.value=1,this.mod4Gain.gain.value=1):(this.mod1Gain.gain.value=1,this.mod2Gain.gain.value=1,this.mod3Gain.gain.value=0,this.mod4Gain.gain.value=0),this.setDelay(o*Math.abs(e))}},428:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FrameProcessor=t.validateOptions=t.defaultFrameProcessorOptions=void 0;const i=s(294),r=s(842),a=[512,1024,1536];t.defaultFrameProcessorOptions={positiveSpeechThreshold:.5,negativeSpeechThreshold:.35,preSpeechPadFrames:1,redemptionFrames:8,frameSamples:1536,minSpeechFrames:3,submitUserSpeechOnPause:!1},t.validateOptions=function(e){a.includes(e.frameSamples)||r.log.warn("You are using an unusual frame size"),(e.positiveSpeechThreshold<0||e.negativeSpeechThreshold>1)&&r.log.error("postiveSpeechThreshold should be a number between 0 and 1"),(e.negativeSpeechThreshold<0||e.negativeSpeechThreshold>e.positiveSpeechThreshold)&&r.log.error("negativeSpeechThreshold should be between 0 and postiveSpeechThreshold"),e.preSpeechPadFrames<0&&r.log.error("preSpeechPadFrames should be positive"),e.redemptionFrames<0&&r.log.error("preSpeechPadFrames should be positive")};const o=e=>{const t=e.reduce(((e,t)=>(e.push(e.at(-1)+t.length),e)),[0]),s=new Float32Array(t.at(-1));return e.forEach(((e,i)=>{const r=t[i];s.set(e,r)})),s};t.FrameProcessor=class{constructor(e,t,s){this.modelProcessFunc=e,this.modelResetFunc=t,this.options=s,this.speaking=!1,this.redemptionCounter=0,this.active=!1,this.reset=()=>{this.speaking=!1,this.audioBuffer=[],this.modelResetFunc(),this.redemptionCounter=0},this.pause=()=>(this.active=!1,this.options.submitUserSpeechOnPause?this.endSegment():(this.reset(),{})),this.resume=()=>{this.active=!0},this.endSegment=()=>{const e=this.audioBuffer;this.audioBuffer=[];const t=this.speaking;this.reset();const s=e.reduce(((e,t)=>e+ +t.isSpeech),0);if(t){if(s>=this.options.minSpeechFrames){const t=o(e.map((e=>e.frame)));return{msg:i.Message.SpeechEnd,audio:t}}return{msg:i.Message.VADMisfire}}return{}},this.process=async e=>{if(!this.active)return{};const t=await this.modelProcessFunc(e);if(this.audioBuffer.push({frame:e,isSpeech:t.isSpeech>=this.options.positiveSpeechThreshold}),t.isSpeech>=this.options.positiveSpeechThreshold&&this.redemptionCounter&&(this.redemptionCounter=0),t.isSpeech>=this.options.positiveSpeechThreshold&&!this.speaking)return this.speaking=!0,{probs:t,msg:i.Message.SpeechStart};if(t.isSpeech<this.options.negativeSpeechThreshold&&this.speaking&&++this.redemptionCounter>=this.options.redemptionFrames){this.redemptionCounter=0,this.speaking=!1;const e=this.audioBuffer;if(this.audioBuffer=[],e.reduce(((e,t)=>e+ +t.isSpeech),0)>=this.options.minSpeechFrames){const s=o(e.map((e=>e.frame)));return{probs:t,msg:i.Message.SpeechEnd,audio:s}}return{probs:t,msg:i.Message.VADMisfire}}if(!this.speaking)for(;this.audioBuffer.length>this.options.preSpeechPadFrames;)this.audioBuffer.shift();return{probs:t}},this.audioBuffer=[],this.reset()}}},14:function(e,t,s){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,s,i){void 0===i&&(i=s);var r=Object.getOwnPropertyDescriptor(t,s);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,i,r)}:function(e,t,s,i){void 0===i&&(i=s),e[i]=t[s]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&i(t,e,s);return r(t,e),t},o=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||i(t,e,s)};Object.defineProperty(t,"__esModule",{value:!0}),t.utils=void 0;const n=a(s(26));t.utils={minFramesForTargetMS:n.minFramesForTargetMS,arrayBufferToBase64:n.arrayBufferToBase64,encodeWAV:n.encodeWAV},o(s(405),t),o(s(428),t),o(s(294),t),o(s(842),t),o(s(260),t),o(s(724),t)},842:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.log=t.LOG_PREFIX=void 0,t.LOG_PREFIX="[VAD]";const s=["error","debug","warn"].reduce(((e,s)=>(e[s]=function(e){return(...s)=>{console[e](t.LOG_PREFIX,...s)}}(s),e)),{});t.log=s},294:(e,t)=>{"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),t.Message=void 0,function(e){e.AudioFrame="AUDIO_FRAME",e.SpeechStart="SPEECH_START",e.VADMisfire="VAD_MISFIRE",e.SpeechEnd="SPEECH_END",e.SpeechStop="SPEECH_STOP"}(s||(t.Message=s={}))},260:(e,t,s)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.Silero=void 0;const r=s(842);class a{constructor(e,t){this.ort=e,this.modelFetcher=t,this.init=async()=>{r.log.debug("initializing vad");const e=await this.modelFetcher();this._session=await this.ort.InferenceSession.create(e),this._sr=new this.ort.Tensor("int64",[16000n]),this.reset_state(),r.log.debug("vad is initialized")},this.reset_state=()=>{const e=Array(128).fill(0);this._h=new this.ort.Tensor("float32",e,[2,1,64]),this._c=new this.ort.Tensor("float32",e,[2,1,64])},this.process=async e=>{const t={input:new this.ort.Tensor("float32",e,[1,e.length]),h:this._h,c:this._c,sr:this._sr},s=await this._session.run(t);this._h=s.hn,this._c=s.cn;const[i]=s.output.data;return{notSpeech:1-i,isSpeech:i}}}}t.Silero=a,i=a,a.new=async(e,t)=>{const s=new i(e,t);return await s.init(),s}},405:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlatformAgnosticNonRealTimeVAD=t.defaultNonRealTimeVADOptions=void 0;const i=s(428),r=s(294),a=s(260),o=s(724);t.defaultNonRealTimeVADOptions={...i.defaultFrameProcessorOptions},t.PlatformAgnosticNonRealTimeVAD=class{static async _new(e,s,i={}){const r=new this(e,s,{...t.defaultNonRealTimeVADOptions,...i});return await r.init(),r}constructor(e,t,s){this.modelFetcher=e,this.ort=t,this.options=s,this.init=async()=>{const e=await a.Silero.new(this.ort,this.modelFetcher);this.frameProcessor=new i.FrameProcessor(e.process,e.reset_state,{frameSamples:this.options.frameSamples,positiveSpeechThreshold:this.options.positiveSpeechThreshold,negativeSpeechThreshold:this.options.negativeSpeechThreshold,redemptionFrames:this.options.redemptionFrames,preSpeechPadFrames:this.options.preSpeechPadFrames,minSpeechFrames:this.options.minSpeechFrames,submitUserSpeechOnPause:this.options.submitUserSpeechOnPause}),this.frameProcessor.resume()},this.run=async function*(e,t){const s={nativeSampleRate:t,targetSampleRate:16e3,targetFrameSize:this.options.frameSamples,targetSpeed:1},i=new o.Resampler(s).process(e);let a,n;for(const e of[...Array(i.length)].keys()){const t=i[e],{msg:s,audio:o}=await this.frameProcessor.process(t);switch(s){case r.Message.SpeechStart:a=e*this.options.frameSamples/16;break;case r.Message.SpeechEnd:n=(e+1)*this.options.frameSamples/16,yield{audio:o,start:a,end:n}}}const{msg:c,audio:u}=this.frameProcessor.endSegment();c==r.Message.SpeechEnd&&(yield{audio:u,start:a,end:i.length*this.options.frameSamples/16})},(0,i.validateOptions)(s)}}},724:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Resampler=void 0;const i=s(842);t.Resampler=class{constructor(e){this.options=e,this.process=e=>{const t=[];for(const t of e)this.inputBuffer.push(t);for(;this.inputBuffer.length*this.options.targetSampleRate*this.options.targetSpeed/this.options.nativeSampleRate>this.options.targetFrameSize;){const e=new Float32Array(this.options.targetFrameSize);let s=0,i=0;for(;s<this.options.targetFrameSize;){let t=0,r=0;for(;i<Math.min(this.inputBuffer.length,(s+1)*this.options.nativeSampleRate/(this.options.targetSampleRate*this.options.targetSpeed));)t+=this.inputBuffer[i],r++,i++;e[s]=t/r,s++}this.inputBuffer=this.inputBuffer.slice(i),t.push(e)}return t},e.nativeSampleRate<16e3&&i.log.error("nativeSampleRate is too low. Should have 16000 = targetSampleRate <= nativeSampleRate"),this.inputBuffer=[]}}},26:(e,t)=>{"use strict";function s(e,t,s){for(var i=0;i<s.length;i++)e.setUint8(t+i,s.charCodeAt(i))}Object.defineProperty(t,"__esModule",{value:!0}),t.encodeWAV=t.arrayBufferToBase64=t.minFramesForTargetMS=void 0,t.minFramesForTargetMS=function(e,t,s=16e3){return Math.ceil(e*s/1e3/t)},t.arrayBufferToBase64=function(e){for(var t="",s=new Uint8Array(e),i=s.byteLength,r=0;r<i;r++)t+=String.fromCharCode(s[r]);return btoa(t)},t.encodeWAV=function(e,t=3,i=16e3,r=1,a=32){var o=a/8,n=r*o,c=new ArrayBuffer(44+e.length*o),u=new DataView(c);return s(u,0,"RIFF"),u.setUint32(4,36+e.length*o,!0),s(u,8,"WAVE"),s(u,12,"fmt "),u.setUint32(16,16,!0),u.setUint16(20,t,!0),u.setUint16(22,r,!0),u.setUint32(24,i,!0),u.setUint32(28,i*n,!0),u.setUint16(32,n,!0),u.setUint16(34,a,!0),s(u,36,"data"),u.setUint32(40,e.length*o,!0),1===t?function(e,t,s){for(var i=0;i<s.length;i++,t+=2){var r=Math.max(-1,Math.min(1,s[i]));e.setInt16(t,r<0?32768*r:32767*r,!0)}}(u,44,e):function(e,t,s){for(var i=0;i<s.length;i++,t+=4)e.setFloat32(t,s[i],!0)}(u,44,e),c}},485:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assetPath=void 0;const s="undefined"!=typeof window&&void 0!==window.document?window.document.currentScript:null;let i="";s&&(i=s.src.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/")),t.assetPath=e=>i+e},973:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultModelFetcher=void 0,t.defaultModelFetcher=e=>fetch(e).then((e=>e.arrayBuffer()))},590:function(e,t,s){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,s,i){void 0===i&&(i=s);var r=Object.getOwnPropertyDescriptor(t,s);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,i,r)}:function(e,t,s,i){void 0===i&&(i=s),e[i]=t[s]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&i(t,e,s);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.defaultRealTimeVADOptions=t.AudioNodeVAD=t.MicVAD=t.NonRealTimeVAD=t.Message=t.FrameProcessor=t.utils=t.defaultNonRealTimeVADOptions=void 0;const o=a(s(656)),n=s(14);Object.defineProperty(t,"FrameProcessor",{enumerable:!0,get:function(){return n.FrameProcessor}}),Object.defineProperty(t,"Message",{enumerable:!0,get:function(){return n.Message}});const c=s(787),u=s(973),h=s(485);t.defaultNonRealTimeVADOptions={modelURL:(0,h.assetPath)("silero_vad.onnx"),modelFetcher:u.defaultModelFetcher};class l extends n.PlatformAgnosticNonRealTimeVAD{static async new(e={}){const{modelURL:s,modelFetcher:i}={...t.defaultNonRealTimeVADOptions,...e};return await this._new((()=>i(s)),o,e)}}t.NonRealTimeVAD=l,t.utils={audioFileToArray:c.audioFileToArray,...n.utils};var d=s(746);Object.defineProperty(t,"MicVAD",{enumerable:!0,get:function(){return d.MicVAD}}),Object.defineProperty(t,"AudioNodeVAD",{enumerable:!0,get:function(){return d.AudioNodeVAD}}),Object.defineProperty(t,"defaultRealTimeVADOptions",{enumerable:!0,get:function(){return d.defaultRealTimeVADOptions}})},746:function(e,t,s){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,s,i){void 0===i&&(i=s);var r=Object.getOwnPropertyDescriptor(t,s);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,i,r)}:function(e,t,s,i){void 0===i&&(i=s),e[i]=t[s]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&i(t,e,s);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.AudioNodeVAD=t.MicVAD=t.defaultRealTimeVADOptions=void 0;const o=a(s(656)),n=s(14),c=s(485),u=s(973);t.defaultRealTimeVADOptions={...n.defaultFrameProcessorOptions,onFrameProcessed:e=>{},onVADMisfire:()=>{n.log.debug("VAD misfire")},onSpeechStart:()=>{n.log.debug("Detected speech start")},onSpeechEnd:()=>{n.log.debug("Detected speech end")},workletURL:(0,c.assetPath)("vad.worklet.bundle.min.js"),modelURL:(0,c.assetPath)("silero_vad.onnx"),modelFetcher:u.defaultModelFetcher,stream:void 0};class h{static async new(e={}){const s={...t.defaultRealTimeVADOptions,...e};let i;(0,n.validateOptions)(s),i=void 0===s.stream?await navigator.mediaDevices.getUserMedia({audio:{...s.additionalAudioConstraints,channelCount:1,echoCancellation:!0,autoGainControl:!0,noiseSuppression:!0}}):s.stream;const r=new AudioContext,a=new MediaStreamAudioSourceNode(r,{mediaStream:i}),o=await l.new(r,s);return o.receive(a),new h(s,r,i,o,a)}constructor(e,t,s,i,r,a=!1){this.options=e,this.audioContext=t,this.stream=s,this.audioNodeVAD=i,this.sourceNode=r,this.listening=a,this.pause=()=>{this.audioNodeVAD.pause(),this.listening=!1},this.start=()=>{this.audioNodeVAD.start(),this.listening=!0},this.destroy=()=>{this.listening&&this.pause(),void 0===this.options.stream&&this.stream.getTracks().forEach((e=>e.stop())),this.sourceNode.disconnect(),this.audioNodeVAD.destroy(),this.audioContext.close()}}}t.MicVAD=h;class l{static async new(e,i={}){const r={...t.defaultRealTimeVADOptions,...i};(0,n.validateOptions)(r),await e.audioWorklet.addModule(r.workletURL);const a=new AudioWorkletNode(e,"vad-helper-worklet",{processorOptions:{frameSamples:r.frameSamples},parameterData:{audioSpeed:1}}),c=await n.Silero.new(o,(()=>r.modelFetcher(r.modelURL))),u=new n.FrameProcessor(c.process,c.reset_state,{frameSamples:r.frameSamples,positiveSpeechThreshold:r.positiveSpeechThreshold,negativeSpeechThreshold:r.negativeSpeechThreshold,redemptionFrames:r.redemptionFrames,preSpeechPadFrames:r.preSpeechPadFrames,minSpeechFrames:r.minSpeechFrames,submitUserSpeechOnPause:r.submitUserSpeechOnPause});let h=s(520)(e);const d=new l(e,r,u,a,h);return a.port.onmessage=async e=>{if(e.data?.message===n.Message.AudioFrame){const t=e.data.data,s=new Float32Array(t);await d.processFrame(s)}},d}constructor(e,t,s,i,r){this.ctx=e,this.options=t,this.frameProcessor=s,this.entryNode=i,this.pitchShift=r,this.pause=()=>{const e=this.frameProcessor.pause();this.handleFrameProcessorEvent(e)},this.start=()=>{this.frameProcessor.resume()},this.receive=e=>{e.connect(this.pitchShift),this.pitchShift.connect(this.entryNode)},this.updateAudioSpeed=e=>{let t=Math.min(e,2);this.entryNode.parameters.get("audioSpeed")?.setValueAtTime(t,this.ctx.currentTime),this.pitchShift.transpose=12*Math.log2(t),console.log("Changed audioSpeed real-time-vad.ts: ",this.entryNode.parameters.get("audioSpeed"))},this.processFrame=async e=>{const t=await this.frameProcessor.process(e);this.handleFrameProcessorEvent(t)},this.handleFrameProcessorEvent=e=>{switch(void 0!==e.probs&&this.options.onFrameProcessed(e.probs),e.msg){case n.Message.SpeechStart:this.options.onSpeechStart();break;case n.Message.VADMisfire:this.options.onVADMisfire();break;case n.Message.SpeechEnd:this.options.onSpeechEnd(e.audio)}},this.destroy=()=>{this.entryNode.port.postMessage({message:n.Message.SpeechStop}),this.entryNode.disconnect()}}}t.AudioNodeVAD=l},787:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.audioFileToArray=void 0,t.audioFileToArray=async function(e){const t=new OfflineAudioContext(1,1,44100),s=new FileReader;let i=null;if(await new Promise((r=>{s.addEventListener("loadend",(e=>{const a=s.result;t.decodeAudioData(a,(e=>{i=e,t.startRendering().then((e=>{console.log("Rendering completed successfully"),r()})).catch((e=>{console.error(`Rendering failed: ${e}`)}))}),(e=>{console.log(`Error with decoding audio data: ${e}`)}))})),s.readAsArrayBuffer(e)})),null===i)throw Error("some shit");let r=i,a=new Float32Array(r.length);for(let e=0;e<r.length;e++)for(let t=0;t<r.numberOfChannels;t++)a[e]+=r.getChannelData(t)[e];return{audio:a,sampleRate:r.sampleRate}}},656:t=>{"use strict";t.exports=e}},s={},function e(i){var r=s[i];if(void 0!==r)return r.exports;var a=s[i]={exports:{}};return t[i].call(a.exports,a,a.exports,e),a.exports}(590);var t,s}));